System.register(["./nomodule-fc37705a.js","./nomodule-7f51a800.js","./nomodule-ab6ed109.js","./nomodule-839ad7e3.js"],(function(e,o){var t,i,r,a,n,s,p,c,d,l,h,u,g,m,f,v,y,C,A,b,_,S,x;return{setters:[function(e){t=e.taggedTemplateLiteral,i=e.createSuper,r=e.inherits,a=e.getPrototypeOf,n=e.get,s=e.createClass,p=e.classCallCheck},function(e){c=e.b,d=e.d,l=e.h,h=e._,u=e.p,g=e.c},function(e){},function(e){}],execute:function(){(function(e){return e}),A=c(C||(C=m||(m=t(["paper-dialog{padding-left:8px;padding-right:8px;width:440px;background-color:#fff}paper-dialog{z-index:9999}@media (max-width:480px){paper-dialog{padding:0;margin:0;height:100%;width:100%}}paper-spinner{padding:0;margin:0}.buttons{margin-left:0;padding-left:0;color:var(--app-accent-color);font-size:18px;padding-top:8px}.checkBox{margin-top:16px}paper-input{--paper-input-container-focus-color:var(--app-accent-color)}paper-checkbox{--paper-checkbox-checked-color:var(--app-accent-color);padding-top:8px}.postcodeWrongWard{color:var(--paper-red-a400)}"])))),function(e){return e},e("OavInsecureEmailLogin",x=function(e){r(c,e);var o=i(c);function c(){var e;return p(this,c),(e=o.call(this)).userSpinner=!1,e.confirmedAge=!1,e.emailValidationPattern="^[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})$",e.postCodes={},e.postCodesAreas={},e.postCodesAreasNames={},e.opened=!1,e.confirmedAge=!1,e}return s(c,[{key:"render",value:function(){return l(b||(b=f||(f=t([' <paper-dialog id="dialog" with-backdrop> <div class="layout horizontal center-center"> <h2>','</h2> </div> <form is="iron-form" id="form"> <paper-input id="email" type="text" label="','" .value="','" minlength="5" .error-message="','"> </paper-input> <paper-input id="postCode" type="text" label="','" .value="','" maxlength="','"> </paper-input> <div class="postcodeWrongWard" ?hidden="','"> '," ",".<br><br> ",' <a href="/area-ballot/','" @click="','">',"</a> "," ",". </div> ",' </form> <div class="buttons layout vertical"> <paper-button autofocus @tap="','">',"</paper-button> </div> </paper-dialog> "]))),this.localize("loginWithEmailAndPostCode"),this.localize("userEmail"),this.email,this.emailErrorMessage,this.localize("postCode"),this.postCode,this.configFromServer.client_config.insecureEmailPostcodeMaxLength,!this.correctAreaId,this.localize("thisPostCodeDoesNotBelongTo"),this.areaName,this.localize("forThisCodeYouCanVoteHere"),this.correctAreaId,this._resetCorrectArea,this.correctAreaName,this.localize("orEnterApostCodeThatBelongsTo"),this.areaName,this.configFromServer.client_config.insecureEmailAgeLimit?l(_||(_=v||(v=t([' <paper-checkbox id="confirmedAge" class="checkBox" name="confirmedAge"> '," </paper-checkbox> "]))),this.localize("confirmAge")):l(S||(S=y||(y=t([""])))),this._validateAndSend,this.localize("authenticateAndVote"))}},{key:"firstUpdated",value:function(e){var o=this;n(a(c.prototype),"firstUpdated",this).call(this,e),Object.entries(this.configFromServer.client_config.insecureEmailLoginPostCodes).forEach((function(e){var t=parseInt(e[0]);e[1].forEach((function(e){o.postCodesAreas[e]=t,o.postCodesAreasNames[e]=o.configFromServer.client_config.insecureEmailLoginAreaNames[t]}))}))}},{key:"_resetCorrectArea",value:function(){var e=this;setTimeout((function(){e.correctAreaId=void 0,e.correctAreaName=void 0,e.close()}),100)}},{key:"_loginCompleted",value:function(){this.onLoginFunction(),this.close()}},{key:"isValidPostcode",value:function(e,o){return o=o.replace(/\s/g,"").toUpperCase(),this.configFromServer.client_config.insecureEmailLoginPostCodes[e].indexOf(o)>-1}},{key:"getAreaForPostCode",value:function(e){return e=e.replace(/\s/g,"").toUpperCase(),this.postCodesAreas[e]&&this.postCodesAreasNames[e]?{id:this.postCodesAreas[e],name:this.postCodesAreasNames[e]}:null}},{key:"open",value:function(e,o,t){this.onLoginFunction=t,this.areaId=e,this.areaName=o,this.userSpinner=!1,this.opened=!1,this.postCode="",this.confirmedAge=!1,this.email="",this.$$("#dialog").open()}},{key:"_validateAndSend",value:function(e){var o=this;if(this.email=this.$$("#email").value,this.postCode=this.$$("#postCode").value,!(this.email&&this.postCode&&this.$$("#confirmedAge").checked))return this.fire("oav-error",this.localize("completeForm")),!1;if(new RegExp(this.emailValidationPattern).test(this.email)){if(this.isValidPostcode(this.areaId,this.postCode))return fetch("/votes/insecure_email_login",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({insecure_email:this.email.toLowerCase(),postCode:this.postCode})}).then((function(e){return e.json()})).then((function(e){e&&!0===e.ok?o._loginCompleted():o.fire("oav-error",o.localize("error_not_authorized"))})).catch((function(){o.fire("oav-error",o.localize("general_error"))})),!0;if(this.getAreaForPostCode(this.postCode)){var t=this.getAreaForPostCode(this.postCode);this.correctAreaId=t.id,this.correctAreaName=t.name}else this.fire("oav-error",this.localize("enterValidPostcode"))}else this.fire("oav-error",this.localize("enterValidEmail"))}},{key:"close",value:function(){var e=this.$$("#dialog");e&&e.close(),this.opened=!1,this.userSpinner=!1}}],[{key:"styles",get:function(){return[A]}}]),c}(d)),h([u({type:Object})],x.prototype,"configFromServer",void 0),h([u({type:Number})],x.prototype,"correctAreaId",void 0),h([u({type:String})],x.prototype,"areaName",void 0),h([u({type:String})],x.prototype,"correctAreaName",void 0),h([u({type:String})],x.prototype,"postCode",void 0),h([u({type:Boolean})],x.prototype,"userSpinner",void 0),h([u({type:Boolean})],x.prototype,"confirmedAge",void 0),h([u({type:String})],x.prototype,"postCodeValidationPattern",void 0),h([u({type:String})],x.prototype,"emailValidationPattern",void 0),h([u({type:String})],x.prototype,"emailErrorMessage",void 0),h([u({type:String})],x.prototype,"passwordErrorMessage",void 0),h([u({type:String})],x.prototype,"name",void 0),h([u({type:String})],x.prototype,"email",void 0),h([u({type:String})],x.prototype,"submitText",void 0),h([u({type:Object})],x.prototype,"onLoginFunction",void 0),h([u({type:Number})],x.prototype,"areaId",void 0),h([u({type:Object})],x.prototype,"postCodes",void 0),h([u({type:Object})],x.prototype,"postCodesAreas",void 0),h([u({type:Object})],x.prototype,"postCodesAreasNames",void 0),h([u({type:Boolean})],x.prototype,"opened",void 0),e("OavInsecureEmailLogin",x=h([g("oav-insecure-email-login")],x))}}}));
