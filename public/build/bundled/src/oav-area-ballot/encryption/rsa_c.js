function parseBigInt(t,e){return new BigInteger(t,e)}function linebrk(t,e){for(var i="",r=0;r+e<t.length;)i+=t.substring(r,r+e)+"\n",r+=e;return i+t.substring(r,t.length)}function byte2Hex(t){return t<16?"0"+t.toString(16):t.toString(16)}function pkcs1unpad2(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var n="";++r<i.length;)n+=String.fromCharCode(i[r]);return n}function pkcs1pad2(t,e){if(e<t.length+11)return alert("Message too long for RSA"),null;for(var i=new Array,r=t.length-1;r>=0&&e>0;)i[--e]=t.charCodeAt(r--);i[--e]=0;for(var n=new SecureRandom,s=new Array;e>2;){for(s[0]=0;0==s[0];)n.nextBytes(s);i[--e]=s[0]}return i[--e]=2,i[--e]=0,new BigInteger(i)}"undefined"!=typeof pidCrypt&&"undefined"!=typeof BigInteger&&"undefined"!=typeof SecureRandom&&"undefined"!=typeof Arcfour&&(pidCrypt.RSA=function(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null},pidCrypt.RSA.prototype.doPrivate=function(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},pidCrypt.RSA.prototype.setPublic=function(t,e,i){"undefined"==typeof i&&(i=16),null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=parseBigInt(t,i),this.e=parseInt(e,i)):alert("Invalid RSA public key")},pidCrypt.RSA.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},pidCrypt.RSA.prototype.encryptRaw=function(t){var e=pkcs1pad2(t,this.n.bitLength()+7>>3);if(null==e)return null;var i=this.doPublic(e);if(null==i)return null;var r=i.toString(16);return 0==(1&r.length)?r:"0"+r},pidCrypt.RSA.prototype.encrypt=function(t){return t=pidCryptUtil.encodeBase64(t),this.encryptRaw(t)},pidCrypt.RSA.prototype.decryptRaw=function(t){var e=parseBigInt(t,16),i=this.doPrivate(e);return null==i?null:pkcs1unpad2(i,this.n.bitLength()+7>>3)},pidCrypt.RSA.prototype.decrypt=function(t){var e=this.decryptRaw(t);return e=e?pidCryptUtil.decodeBase64(e):""},pidCrypt.RSA.prototype.setPrivate=function(t,e,i,r){"undefined"==typeof r&&(r=16),null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=parseBigInt(t,r),this.e=parseInt(e,r),this.d=parseBigInt(i,r)):alert("Invalid RSA private key")},pidCrypt.RSA.prototype.setPrivateEx=function(t,e,i,r,n,s,p,o,h){"undefined"==typeof h&&(h=16),null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=parseBigInt(t,h),this.e=parseInt(e,h),this.d=parseBigInt(i,h),this.p=parseBigInt(r,h),this.q=parseBigInt(n,h),this.dmp1=parseBigInt(s,h),this.dmq1=parseBigInt(p,h),this.coeff=parseBigInt(o,h)):alert("Invalid RSA private key")},pidCrypt.RSA.prototype.generate=function(t,e){var i=new SecureRandom,r=t>>1;this.e=parseInt(e,16);for(var n=new BigInteger(e,16);;){for(;this.p=new BigInteger(t-r,1,i),0!=this.p.subtract(BigInteger.ONE).gcd(n).compareTo(BigInteger.ONE)||!this.p.isProbablePrime(10););for(;this.q=new BigInteger(r,1,i),0!=this.q.subtract(BigInteger.ONE).gcd(n).compareTo(BigInteger.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var p=this.p.subtract(BigInteger.ONE),o=this.q.subtract(BigInteger.ONE),h=p.multiply(o);if(0==h.gcd(n).compareTo(BigInteger.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(h),this.dmp1=this.d.mod(p),this.dmq1=this.d.mod(o),this.coeff=this.q.modInverse(this.p);break}}},pidCrypt.RSA.prototype.getASNData=function(t){var e=[],i=0;if(t.value&&"INTEGER"==t.type&&(e[i++]=t.value),t.sub)for(var r=0;r<t.sub.length;r++)e=e.concat(this.getASNData(t.sub[r]));return e},pidCrypt.RSA.prototype.setKeyFromASN=function(t,e){var i=["N","E","D","P","Q","DP","DQ","C"],r={},n=this.getASNData(e);switch(t){case"Public":case"public":for(var s=0;s<n.length;s++)r[i[s]]=n[s].toLowerCase();this.setPublic(r.N,r.E,16);break;case"Private":case"private":for(var s=1;s<n.length;s++)r[i[s-1]]=n[s].toLowerCase();this.setPrivateEx(r.N,r.E,r.D,r.P,r.Q,r.DP,r.DQ,r.C,16)}},pidCrypt.RSA.prototype.setPublicKeyFromASN=function(t){this.setKeyFromASN("public",t)},pidCrypt.RSA.prototype.setPrivateKeyFromASN=function(t){this.setKeyFromASN("private",t)},pidCrypt.RSA.prototype.getParameters=function(){var t={};return null!=this.n&&(t.n=this.n),t.e=this.e,null!=this.d&&(t.d=this.d),null!=this.p&&(t.p=this.p),null!=this.q&&(t.q=this.q),null!=this.dmp1&&(t.dmp1=this.dmp1),null!=this.dmq1&&(t.dmq1=this.dmq1),null!=this.coeff&&(t.c=this.coeff),t});