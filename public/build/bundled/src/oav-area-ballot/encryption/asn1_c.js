function Stream(t,e){t instanceof Stream?(this.enc=t.enc,this.pos=t.pos):(this.enc=t,this.pos=e)}Stream.prototype.parseStringHex=function(t,e){"undefined"==typeof e&&(e=this.enc.length);for(var r="",s=t;s<e;++s){var n=this.get(s);r+=this.hexDigits.charAt(n>>4)+this.hexDigits.charAt(15&n)}return r},Stream.prototype.get=function(t){if(void 0==t&&(t=this.pos++),t>=this.enc.length)throw"Requesting byte offset "+t+" on a stream of length "+this.enc.length;return this.enc[t]},Stream.prototype.hexDigits="0123456789ABCDEF",Stream.prototype.hexDump=function(t,e){for(var r="",s=t;s<e;++s){var n=this.get(s);r+=this.hexDigits.charAt(n>>4)+this.hexDigits.charAt(15&n),7==(15&s)&&(r+=" "),r+=15==(15&s)?"\n":" "}return r},Stream.prototype.parseStringISO=function(t,e){for(var r="",s=t;s<e;++s)r+=String.fromCharCode(this.get(s));return r},Stream.prototype.parseStringUTF=function(t,e){for(var r="",s=0,n=t;n<e;){var s=this.get(n++);r+=s<128?String.fromCharCode(s):s>191&&s<224?String.fromCharCode((31&s)<<6|63&this.get(n++)):String.fromCharCode((15&s)<<12|(63&this.get(n++))<<6|63&this.get(n++))}return r},Stream.prototype.reTime=/^((?:1[89]|2\d)?\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,Stream.prototype.parseTime=function(t,e){var r=this.parseStringISO(t,e),s=this.reTime.exec(r);return s?(r=s[1]+"-"+s[2]+"-"+s[3]+" "+s[4],s[5]&&(r+=":"+s[5],s[6]&&(r+=":"+s[6],s[7]&&(r+="."+s[7]))),s[8]&&(r+=" UTC","Z"!=s[8]&&(r+=s[8],s[9]&&(r+=":"+s[9]))),r):"Unrecognized time: "+r},Stream.prototype.parseInteger=function(t,e){if(!(e-t>4)){for(var r=0,s=t;s<e;++s)r=r<<8|this.get(s);return r}},Stream.prototype.parseOID=function(t,e){for(var r,s=0,n=0,i=t;i<e;++i){var a=this.get(i);s=s<<7|127&a,n+=7,128&a||(void 0==r?r=parseInt(s/40)+"."+s%40:r+="."+(n>=31?"big":s),s=n=0),r+=String.fromCharCode()}return r},"undefined"!=typeof pidCrypt&&(pidCrypt.ASN1=function(t,e,r,s,n){this.stream=t,this.header=e,this.length=r,this.tag=s,this.sub=n},pidCrypt.ASN1.prototype.toHexTree=function(){var t={};if(t.type=this.typeName(),"SEQUENCE"!=t.type&&(t.value=this.stream.parseStringHex(this.posContent(),this.posEnd())),null!=this.sub){t.sub=[];for(var e=0,r=this.sub.length;e<r;++e)t.sub[e]=this.sub[e].toHexTree()}return t},pidCrypt.ASN1.prototype.typeName=function(){if(void 0==this.tag)return"unknown";var t=this.tag>>6,e=(this.tag>>5&1,31&this.tag);switch(t){case 0:switch(e){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString";default:return"Universal_"+e.toString(16)}case 1:return"Application_"+e.toString(16);case 2:return"["+e+"]";case 3:return"Private_"+e.toString(16)}},pidCrypt.ASN1.prototype.content=function(){if(void 0==this.tag)return null;var t=this.tag>>6;if(0!=t)return null;var e=31&this.tag,r=this.posContent(),s=Math.abs(this.length);switch(e){case 1:return 0==this.stream.get(r)?"false":"true";case 2:return this.stream.parseInteger(r,r+s);case 6:return this.stream.parseOID(r,r+s);case 12:return this.stream.parseStringUTF(r,r+s);case 18:case 19:case 20:case 21:case 22:case 26:return this.stream.parseStringISO(r,r+s);case 23:case 24:return this.stream.parseTime(r,r+s)}return null},pidCrypt.ASN1.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null==this.sub?"null":this.sub.length)+"]"},pidCrypt.ASN1.prototype.print=function(t){if(void 0==t&&(t=""),document.writeln(t+this),null!=this.sub){t+="  ";for(var e=0,r=this.sub.length;e<r;++e)this.sub[e].print(t)}},pidCrypt.ASN1.prototype.toPrettyString=function(t){void 0==t&&(t="");var e=t+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(e+="+"),e+=this.length,32&this.tag?e+=" (constructed)":3!=this.tag&&4!=this.tag||null==this.sub||(e+=" (encapsulates)"),e+="\n",null!=this.sub){t+="  ";for(var r=0,s=this.sub.length;r<s;++r)e+=this.sub[r].toPrettyString(t)}return e},pidCrypt.ASN1.prototype.toDOM=function(){var t=document.createElement("div");t.className="node",t.asn1=this;var e=document.createElement("div");e.className="head";var r=this.typeName();e.innerHTML=r,t.appendChild(e),this.head=e;var s=document.createElement("div");s.className="value",r="Offset: "+this.stream.pos+"<br/>",r+="Length: "+this.header+"+",r+=this.length>=0?this.length:-this.length+" (undefined)",32&this.tag?r+="<br/>(constructed)":3!=this.tag&&4!=this.tag||null==this.sub||(r+="<br/>(encapsulates)");var n=this.content();if(null!=n&&(r+="<br/>Value:<br/><b>"+n+"</b>","object"==typeof oids&&6==this.tag)){var i=oids[n];i&&(i.d&&(r+="<br/>"+i.d),i.c&&(r+="<br/>"+i.c),i.w&&(r+="<br/>(warning!)"))}s.innerHTML=r,t.appendChild(s);var a=document.createElement("div");if(a.className="sub",null!=this.sub)for(var o=0,h=this.sub.length;o<h;++o)a.appendChild(this.sub[o].toDOM());return t.appendChild(a),e.switchNode=t,e.onclick=function(){var t=this.switchNode;t.className="node collapsed"==t.className?"node":"node collapsed"},t},pidCrypt.ASN1.prototype.posStart=function(){return this.stream.pos},pidCrypt.ASN1.prototype.posContent=function(){return this.stream.pos+this.header},pidCrypt.ASN1.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},pidCrypt.ASN1.prototype.toHexDOM_sub=function(t,e,r,s,n){if(!(s>=n)){var i=document.createElement("span");i.className=e,i.appendChild(document.createTextNode(r.hexDump(s,n))),t.appendChild(i)}},pidCrypt.ASN1.prototype.toHexDOM=function(){var t=document.createElement("span");if(t.className="hex",this.head.hexNode=t,this.head.onmouseover=function(){this.hexNode.className="hexCurrent"},this.head.onmouseout=function(){this.hexNode.className="hex"},this.toHexDOM_sub(t,"tag",this.stream,this.posStart(),this.posStart()+1),this.toHexDOM_sub(t,this.length>=0?"dlen":"ulen",this.stream,this.posStart()+1,this.posContent()),null==this.sub)t.appendChild(document.createTextNode(this.stream.hexDump(this.posContent(),this.posEnd())));else if(this.sub.length>0){var e=this.sub[0],r=this.sub[this.sub.length-1];this.toHexDOM_sub(t,"intro",this.stream,this.posContent(),e.posStart());for(var s=0,n=this.sub.length;s<n;++s)t.appendChild(this.sub[s].toHexDOM());this.toHexDOM_sub(t,"outro",this.stream,r.posEnd(),this.posEnd())}return t},pidCrypt.ASN1.decodeLength=function(t){var e=t.get(),r=127&e;if(r==e)return r;if(r>3)throw"Length over 24 bits not supported at position "+(t.pos-1);if(0==r)return-1;e=0;for(var s=0;s<r;++s)e=e<<8|t.get();return e},pidCrypt.ASN1.hasContent=function(t,e,r){if(32&t)return!0;if(t<3||t>4)return!1;var s=new Stream(r);3==t&&s.get();var n=s.get();if(n>>6&1)return!1;try{var i=pidCrypt.ASN1.decodeLength(s);return s.pos-r.pos+i==e}catch(t){return!1}},pidCrypt.ASN1.decode=function(t){t instanceof Stream||(t=new Stream(t,0));var e=new Stream(t),r=t.get(),s=pidCrypt.ASN1.decodeLength(t),n=t.pos-e.pos,i=null;if(pidCrypt.ASN1.hasContent(r,s,t)){var a=t.pos;if(3==r&&t.get(),i=[],s>=0){for(var o=a+s;t.pos<o;)i[i.length]=pidCrypt.ASN1.decode(t);if(t.pos!=o)throw"Content size is not correct for container starting at offset "+a}else try{for(;;){var h=pidCrypt.ASN1.decode(t);if(0==h.tag)break;i[i.length]=h}s=a-t.pos}catch(t){throw"Exception while decoding undefined length content: "+t}}else t.pos+=s;return new pidCrypt.ASN1(e,n,s,r,i)},pidCrypt.ASN1.test=function(){for(var t=[{value:[39],expected:39},{value:[129,201],expected:201},{value:[131,254,220,186],expected:16702650}],e=0,r=t.length;e<r;++e){var s=new Stream(t[e].value,0),n=pidCrypt.ASN1.decodeLength(s);n!=t[e].expected&&document.write("In test["+e+"] expected "+t[e].expected+" got "+n+"\n")}});