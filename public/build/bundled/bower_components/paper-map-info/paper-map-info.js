var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},__decorate=this&&this.__decorate||function(t,e,i,o){var s,n=arguments.length,r=n<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(r=(n<3?s(r):n>3?s(e,i,r):s(e,i))||r);return n>3&&r&&Object.defineProperty(e,i,r),r},paperMapInfo=function(t){function e(){t.apply(this,arguments)}return __extends(e,t),e.prototype.close=function(){this.isShowing=!1,this.$.infocarddiv.style.opacity=0,this.$.infocarddiv.style.left=0,this.$.infocarddiv.style.display="none",this.$.stdbeak.style.display="none",this.$.custombeak.style.display="none",this.$.stdbeak.style.opacity=0,this.$.custombeak.style.opacity=0,this._releaseListeners(),this._marker=void 0},e.prototype._contentChanged=function(){var t=this;this.isShowing&&(this._contentObserver&&this._contentObserver.disconnect(),setTimeout(function(){t._getInfowindowSize();var e=t._setInfowindowPosition();t._placementInBounds(e)||t._panToShowInfowindow(e),t._contentObserver=new MutationObserver(function(){t._contentChanged()}),t._contentObserver.observe(t,{childList:!0,subtree:!0,characterData:!0})},300))},e.prototype.detached=function(){this.isShowing=!1,this.$.infocarddiv.style.left=0,this.$.infocarddiv.style.opacity=this.fadeIn?0:1,this.$.infocarddiv.style.display="none",this.$.stdbeak.display="none",this.$.custombeak.display="none",this.$.stdbeak.opacity=0,this.$.custombeak.opacity=0,this._releaseListeners(),this._marker=void 0,this.map=void 0},e.prototype._doFadeIn=function(){var t=this;if(this.isShowing){var e=parseFloat(this.$.infocarddiv.style.opacity);e>=.9?this.$.infocarddiv.style.opacity="1":(e+=.1,this.$.infocarddiv.style.opacity=e.toString(),setTimeout(function(){t._doFadeIn()},40))}},e.prototype._getInfowindowSize=function(){var t=this.$.infocarddiv;if(this._dim.card.width=t.offsetWidth,this._dim.card.height=t.offsetHeight,this.$.custombeak.innerHTML.trim()){var e=this.$.custombeak;this._dim.beak.height=e.offsetHeight,this._dim.beak.width=e.offsetWidth,this._dim.customBeak=!0}else this._dim.beak={height:20,width:20},this._dim.customBeak=!1},e.prototype._getMarkerSize=function(){if(this._marker&&this._marker.getIcon()){var t=this._marker.getIcon();this._dim.marker.y=t.anchor.y,this._dim.marker.x=0}else this._dim.marker={x:0,y:42}},e.prototype._getMapSize=function(){var t=this.map.getDiv();this._dim.map.width=t.offsetWidth,this._dim.map.height=t.offsetHeight},e.prototype._initListeners=function(){var t=this;this._mapListeners=[],this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map);var e=_.throttle(function(){t._getInfowindowSize(),t._setInfowindowPosition()},25);this._mapListeners.push(google.maps.event.addListener(this.map,"projection_changed",function(){t._overlay=new google.maps.OverlayView,t._overlay.draw=function(){},t._overlay.setMap(t.map)})),this._mapListeners.push(google.maps.event.addListener(this.map,"zoom_changed",function(e){t.isShowing&&(t._getInfowindowSize(),t._setInfowindowPosition())})),this._mapListeners.push(google.maps.event.addListener(this.map,"center_changed",function(i){t.isShowing&&e()})),this._mapListeners.push(google.maps.event.addListener(this._marker,"drag",function(e){t.isShowing&&t._setInfowindowPosition()})),this._contentObserver&&this._contentObserver.disconnect(),this._contentObserver=new MutationObserver(function(){t._contentChanged()}),this._contentObserver.observe(this,{childList:!0,subtree:!0,characterData:!0})},e.prototype._mapChanged=function(t,e){this.map&&(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map))},e.prototype._panToShowInfowindow=function(t){var e={x:0,y:0};t.left<0?e.x=t.left-10:t.left+this._dim.card.width>this._dim.map.width&&(e.x=t.left+this._dim.card.width-this._dim.map.width+10),t.top<0?e.y=t.top-10:t.top+this._dim.card.height+this._dim.marker.y+10>this._dim.map.height&&(e.y=t.top+this._dim.card.height+this._dim.marker.y-this._dim.map.height+20),0==e.x&&0==e.y||this.map.panBy(e.x,e.y)},e.prototype._placementInBounds=function(t){var e=t.top>=0&&t.left>=0&&t.left+this._dim.card.width<this._dim.map.width&&t.top+this._dim.card.height+this._dim.marker.y+10<this._dim.map.height;return e},e.prototype.ready=function(){this.map&&(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map))},e.prototype._releaseListeners=function(){for(var t=0,e=this._mapListeners;t<e.length;t++){var i=e[t];google.maps.event.removeListener(i)}this._mapListeners=[],this._contentObserver&&(this._contentObserver.disconnect(),this._contentObserver=void 0)},e.prototype._setInfowindowPosition=function(){this._overlay||(this._overlay=new google.maps.OverlayView,this._overlay.draw=function(){},this._overlay.setMap(this.map),console.log("overlay not set"));var t=this._overlay.getProjection().fromLatLngToContainerPixel(this._marker.getPosition()),e=Math.round(t.x-this._dim.card.width/2),i=Math.round(t.y-this._dim.card.height-this._dim.marker.y-this._dim.beak.height+10);this.$.infocarddiv.style.left=e+"px",this.$.infocarddiv.style.top=i+"px";var o=this.$.custombeak.innerHTML.trim()?this.$.custombeak:this.$.stdbeak;return o.style.left=t.x-this._dim.beak.width/2+"px",o.style.top=Math.floor(i-10+this._dim.card.height)+"px",{left:e,top:i}},e.prototype.showInfoWindow=function(t){var e=this;if(this.map&&t){this.isShowing&&this.close(),this._marker=t,this._initListeners(),this.isShowing=!0,this.$.infocarddiv.style.display="block";var i=this.$.custombeak.innerHTML.trim()?this.$.custombeak:this.$.stdbeak,o=this.$.custombeak.innerHTML.trim()?this.$.stdbeak:this.$.custombeak;i.style.opacity=0,i.style.display="block",o.style.opacity=0,o.style.display="none",setTimeout(function(){e._initListeners(),e._getInfowindowSize(),e._getMapSize(),e._getMarkerSize();var t=e._setInfowindowPosition();e.$.infocarddiv.style.opacity=e.fadeIn?0:1,i.style.opacity=1,e.fadeIn&&e._doFadeIn(),e._placementInBounds(t)||e._panToShowInfowindow(t)},33)}},__decorate([property({type:Object,notify:!0})],e.prototype,"_contentObserver",void 0),__decorate([property({type:Number,notify:!0,value:4})],e.prototype,"elevation",void 0),__decorate([property({type:Boolean,notify:!0,value:!1})],e.prototype,"fadeIn",void 0),__decorate([property({type:Boolean,notify:!0,value:!1})],e.prototype,"isShowing",void 0),__decorate([property({type:Object,notify:!0,value:function(){return{card:{height:10,width:10},map:{height:100,width:100},marker:{x:0,y:42},beak:{width:20,height:20,customBeak:!1}}}})],e.prototype,"_dim",void 0),__decorate([property({type:Object,notify:!0,observer:"_mapChanged"})],e.prototype,"map",void 0),__decorate([property({type:Array,notify:!0,value:function(){return[]}})],e.prototype,"_mapListeners",void 0),__decorate([property({type:Object,notify:!0})],e.prototype,"_marker",void 0),__decorate([property({type:Object,notify:!0})],e.prototype,"_overlay",void 0),e=__decorate([component("paper-map-info")],e)}(polymer.Base);paperMapInfo.register();