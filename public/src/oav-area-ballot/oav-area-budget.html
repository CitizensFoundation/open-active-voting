<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../oav-ajax/oav-ajax.html">

<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<dom-module id="oav-area-budget">
  <style include="iron-flex iron-flex-alignment">

    :host {
      width: 100%;
    }

    .budgetContainer {
      height: 300px;
      width: 100%;
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
      background-image: url("https://yrpri6-production.s3.amazonaws.com/cZ/xw/CF-large.png");
    }

    .budgetMaterial {
      width: 960px;
      background-color: #fff;
      height: 220px;
      margin: 10px 0px;
      @apply(--layout-vertical);
    }

    #votes {
      width: 960px;
      background-color: #b9b9b9;
      height: 110px;
      @apply(--layout-horizontal);
    }

    #votes div {
      float: left;
      display: inline-block;
      height: 29px;
      background: #369;
      color: #f00;
      margin: 1px 0 0 1px;
      font-weight: bold;
      padding-top: 12px;
      font-size: 16px;
      text-transform:capitalize;
      width:10px;
    }

    .vote_class {
      float: left;
      display: inline-block;
      height: 29px;
      background: #369;
      color: #f00;
      margin: 1px 0 0 1px;
      font-weight: bold;
      padding-top: 12px;
      font-size: 16px;
      text-transform:capitalize;
    }

    .budgetRuler {
      background-color: var(--paper-green-700);
      color: #FFF;
      font-size: 18px;
      padding: 8px;
      padding-bottom: 8px;
      padding-right: 16px;
      padding-left: 16px;
    }

    .budgetHeader {
      background-color: var(--paper-green-800);
      color: #FFF;
      font-size: 26px;
      padding: 12px;
    }

    .info {
      background-color: var(--paper-green-700);
      padding: 8px;
      font-size: 19px;
    }

    paper-button.voteButton {
      background-color: var(--paper-yellow-a400);
      color: #333;
      margin: 8px;
    }

    .selectedInfo {
      padding-top: 4px;
      font-size: 20px;
    }
  </style>

  <template>

    <div class="budgetContainer">
      <paper-material elevation="5" class="budgetMaterial">
        <div class="budgetRuler layout horizontal justified">
          <div>0m</div>
          <div>12.5m</div>
          <div>25m</div>
        </div>
        <div id="votes"></div>
        <div class="info layout horizontal">
          <div class="flex layout vertical">
            <div>Kjóstu þín verkefni í fjárhagsáætlun fyrir Kársnes</div>
            <div class="selectedInfo">{{localize("selected_ideas_info", "number_of_ideas", selectedIdeaIds.length, "selectedBudget", selectedBudget)}}</div>
          </div>
          <div class="end-justified">
            <paper-button raised class="voteButton">Kjósa!</paper-button>
          </div>
        </div>
      </paper-material>
    </div>
  </template>

</dom-module>

<script>
  (function() {
    Polymer({

      is: 'oav-area-budget',

      behaviors: [
        Polymer.appHelpers,
        Polymer.AppLocalizeBehavior
      ],

      properties: {

        selectedIdeaIds: {
          type: Array,
          value: []
        },

        areaName: {
          type: String,
          value: "Kársnes"
        },

        selectedBudget: {
          type: Number,
          value: 0
        },

        totalBudget: {
          type: Number,
          value: 25.0
        },

        votesWidth: {
          type: Number,
          value: 960
        }
      },

      reset: function () {
        this.set('selectedIdeaIds', []);
        this.set('selectedBudget', 0);
      },

      toggleBudgetIdea: function (idea) {
        if (this.selectedIdeaIds.indexOf(idea.id) > -1) {
          this.splice('selectedIdeaIds', idea.id);
          var selectedIdeaDiv = this.$$("#idea_id_"+idea.id);
          selectedIdeaDiv.parentNode.removeChild(selectedIdeaDiv);
          this.set('selectedBudget', this.selectedBudget - idea.price);
        } else {
          var ideaWidth = parseInt(this.votesWidth * (idea.price / this.totalBudget))-10;
          this.push('selectedIdeaIds', idea.id);
          var image = document.createElement("iron-image");
          image.src = idea.imageUrl;
          image.setAttribute("sizing", "cover");
          image.setAttribute('alt', idea.name);
          image.setAttribute('title', idea.name);
          image.title= idea.name;
          image.style.width = ideaWidth + 'px';
          image.id = "idea_id_"+idea.id;
          image.style.height = '100px';
         // selectedIdea.appendChild(image);
          this.$.votes.appendChild(image);
          this.set('selectedBudget', this.selectedBudget + idea.price);
        }
      },

      convertDots: function (num) {
        return num.replace(".", ",");
      }
    })
  })();

</script>

