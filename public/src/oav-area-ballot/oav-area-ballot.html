<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/app-localize-behavior/app-localize-behavior.html">

<link rel="import" href="../oav-ajax/oav-ajax.html">
<link rel="import" href="oav-area-budget.html">

<dom-module id="oav-area-ballot">
  <style>

    iron-list {
      margin-top: 90px;
      padding-bottom: 16px;
    }

    .ideaContent {
      @apply(--layout);
      background-color: #ddd;
      position: relative;
      width: 300px;
      height: 300px;
      margin: 8px;
    }

    .ideaContent:hover .detail{
      opacity: 1;
    }

    .ideaContent > iron-image {
      @apply(--layout-flex);
    }

    .ideaContent > .detail {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, rgba(0,0,0,0.8) 100%);
      color: white;
      font-size: 20px;
      font-weight: 100;
      padding: 20px;
      opacity: 0;
      transition: opacity 0.1s;
    }

    @media (max-width: 800px) {
      .ideaContainer {
        width: calc(50% - 16px);
      }

      .ideaContent {
        width: auto;
      }
    }

    @media (max-width: 400px) {
      iron-list {
        margin-top: 72px;
      }

      .ideaContainer {
        width: 100%;
      }

      .ideaContent > .detail {
        opacity: 1;
      }
    }
  </style>

  <template>

    <oav-ballot-budget id="budget"></oav-ballot-budget>

    <iron-list items="[[ballot.ballot_items]]" as="idea" scroll-target="document" grid>
      <template>
        <div class="ideaContainer">
          <div class="ideaContent" tabindex$="[[tabIndex]]">
            <iron-image sizing="cover"
                        src="[[_randomImage()]]">
            </iron-image>
            <div class="detail">[[idea.name]]</div>
          </div>
        </div>
      </template>
    </iron-list>

    <oav-ajax id="getBallotAjax" url="/votes/get_ballot" on-response="_ballotResponse"></oav-ajax>
  </template>

</dom-module>

<script>
  (function() {
    Polymer({

      is: 'oav-area-ballot',

      behaviors: [
        Polymer.appHelpers,
        Polymer.AppLocalizeBehavior
      ],

      properties: {

        ballot: {
          type: Object,
          value: null
        },

        areaId: {
          type: String,
          observer: '_areaIdChanged'
        },

        idRoutePath: {
          type: Object,
          observer: '_idRoutePathChanged'
        },

        language: {
          value: 'is'
        }
      },

      _randomImage: function () {
        var myRandomImages = [
                "https://yrpri6-production.s3.amazonaws.com/5X/aK/tG-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/9k/P4/RF-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/Fc/gy/To-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/Tr/Sw/b9-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/GX/sE/Ei-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/Aa/aW/EQ-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/eo/4w/k7-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/J8/GN/KB-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/rH/9W/Ih-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/F5/0N/Gs-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/vv/TJ/YP-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/KW/Xp/nh-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/Y4/M6/a8-retina.png",
                "https://yrpri6-production.s3.amazonaws.com/li/3l/Mv-retina.png"
        ];

        var randomNum = Math.floor(Math.random() * myRandomImages.length);
        return myRandomImages[randomNum];
      },

      _idRoutePathChanged: function (newPathForId) {
        if (newPathForId) {
          this.set('areaId', newPathForId.path.slice(1));
        }
      },

      _areaIdChanged: function (newAreaId) {
        debugger;
        if (newAreaId) {
          this.set('ballot', null);
          this.$.getBallotAjax.params = { area_id: newAreaId };
          this.$.getBallotAjax.generateRequest();
        }
      },

      _ballotResponse: function (event, detail) {
        this.set('ballot', detail.response);
        debugger;
      },

      attached: function() {
        this.loadResources(this.resolveUrl('../locales.json'));
      }
    })
  })();

</script>

