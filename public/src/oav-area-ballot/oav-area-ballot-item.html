<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../../bower_components/iron-icons/image-icons.html">

<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">

<link rel="import" href="../../bower_components/google-map/google-map.html">
<link rel="import" href="../../bower_components/google-map/google-map-marker.html">

<link rel="import" href="../oav-ajax/oav-ajax.html">
<link rel="import" href="oav-area-budget.html">

<dom-module id="oav-area-ballot-item">
  <style>
    .ideaContent {
      @apply(--layout-vertical);
      position: relative;
      width: 300px !important;
      height: 320px;
      margin: 16px;
    }

    .ideaSelectedFrame {
      background: transparent;
      border: none;
      width: 294px;
      height: 314px;
      position: absolute;
      top: 0;
      left: 0;
      z-index: 2;
    }

    .buttons {
      z-index: 5;
    }

    .ideaSelectedFrame[selected] {
      background: transparent;
      border: solid 3px;
      border-color: var(--paper-yellow-a700);
    }

    iron-image {
      height: 169px;
      width: 300px;
    }

    google-map {
      height: 169px;
      width: 300px;
      margin-bottom: 7px;
    }

    .descriptionContainer {
      height: 169px;
      width: 300px;
      overflow: hidden;
      margin-bottom: 7px;
    }

    .description {
      padding: 8px;
    }

    .name {
      font-size: 21px;
      padding-left: 8px;
      padding-right: 8px;
    }

    .price {
      font-size: 25px;
      position: absolute;
      bottom: 8px;
      left: 16px;
      color: var(--paper-yellow-a200);
    }

    paper-fab.addRemoveButton {
      position: absolute;
      bottom: 12px;
      right: 16px;
      background-color: var(--paper-yellow-a400);
      color: #333;
    }

    paper-fab[disabled] {
      background-color: #999;
    }

    .budgetContainer {
      @apply(--layout-horizontal);
      @apply(--layout-center-center);
    }

    .ideaContent {
      background-color: #888;
    }

    .addRemoveButton {}

    .infoIcon {
      color: #ddd;
      width: 45px;
      height: 45px;
    }

    .infoLinks {
      position: absolute;
      bottom: 4px;
      left: 80px;
      z-index: 5;
    }

    paper-fab.removeButton {
      background-color: var(--paper-green-500);
      color: #FFF;
    }
  </style>

  <template>
    <paper-material elevation="2" class="ideaContent">
      <div class="ideaSelectedFrame" selected$="[[selectedInBudget]]"></div>
      <iron-pages selected="[[selectedInfoPanel]]" attr-for-selected="name">
        <iron-image name="image" sizing="cover" src="[[idea.imageUrl]]"></iron-image>
        <google-map zoom="15" name="map" id="map" api-key="[[googleMapsApiKey]]" fit-to-markers>
          <google-map-marker latitude="[[idea.location.latitude]]" longitude="[[idea.location.longitude]]" class="marker"></google-map-marker>
        </google-map>
        <div name="description" class="descriptionContainer">
          <div class="description">[[idea.description]]</div>
        </div>
      </iron-pages>
      <div class="layout horizontal">
        <div class="name">[[idea.name]]
          <a href="https://okkar-kopavogur.betraisland.is/#!/post/7428" target="_blank">
            <paper-icon-button class="infoIcon" icon="info-outline"></paper-icon-button>
          </a>
        </div>
      </div>
      <div class="layout horizontal center-center">
        <div class="price">[[idea.price]]m</div>
      </div>
      <div class="infoLinks">
        <paper-icon-button class="infoIcon" icon="image:photo" on-tap="_setImageMode"></paper-icon-button>
        <paper-icon-button class="infoIcon" icon="description" on-tap="_setDescriptionMode"></paper-icon-button>
        <paper-icon-button class="infoIcon" icon="maps:place" on-tap="_setMapMode"></paper-icon-button>
      </div>
      <div class="buttons">
        <paper-fab mini elevation="5" class="addRemoveButton" hidden$="[[selectedInBudget]]" disabled$="[[toExpensiveForBudget]]" title="{{localize('add_to_budget')}}" icon="check" on-tap="_toggleInBudget"></paper-fab>
        <paper-fab mini elevation="5" class="addRemoveButton removeButton" hidden$="[[!selectedInBudget]]" disabled$="[[toExpensiveForBudget]]" title="{{localize('remove_from_budget')}}" icon="remove" on-tap="_toggleInBudget"></paper-fab>
      </div>
    </paper-material>
  </template>

</dom-module>

<script>
  (function() {
    Polymer({

      is: 'oav-area-ballot-item',

      behaviors: [
        Polymer.appHelpers,
        Polymer.AppLocalizeBehavior
      ],

      properties: {
        idea: {
          type: Object
        },

        selectedInfoPanel: {
          type: String,
          value: 'image'
        },

        selectedInBudget: {
          type: Boolean,
          value: false
        },

        toExpensiveForBudget: {
          type: Boolean,
          value: false
        },

        googleMapsApiKey: {
          type: String,
          value: "AIzaSyDkF_kak8BVZA5zfp5R4xRnrX8HP3hjiL0"
        }
      },

      _setImageMode: function () {
        this.set('selectedInfoPanel', 'image');
      },

      _setMapMode: function () {
        this.set('selectedInfoPanel', 'map');
      },

      _setDescriptionMode: function () {
        this.set('selectedInfoPanel', 'description');
      },

      setInBudget: function () {
        this.set('selectedInBudget', true);
      },

      removeFromBudget: function () {
        this.set('selectedInBudget', false);
      },

      setToExpensive: function () {
        this.set('toExpensiveForBudget', true);
      },

      setNotToExpensive: function () {
        this.set('toExpensiveForBudget', false);
      },

      attached: function() {
        this.loadResources(this.resolveUrl('../locales.json'));
      },

      _toggleInBudget: function (event) {
        this.fire('oav-toggle-idea-in-budget', { idea: this.idea });
      }
    })
  })();

</script>

